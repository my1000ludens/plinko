<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My 1000 Ludens</title>
    
    <script type="module" crossorigin>
var I=Object.defineProperty;var M=(n,s,t)=>s in n?I(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t;var r=(n,s,t)=>(M(n,typeof s!="symbol"?s+"":s,t),t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function t(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(e){if(e.ep)return;e.ep=!0;const o=t(e);fetch(e.href,o)}})();class O{constructor(s,t){r(this,"x");r(this,"y");r(this,"alive",!0);this.x=s,this.y=t}isOutOfScreen(s,t){return this.x<0||this.x>s||this.y<0||this.y>t}update(s){throw new Error("Not implemented")}render(s){throw new Error("Not implemented")}destroy(){this.alive=!1}}class f extends O{constructor(t,i,e=0,o=0,h=0,d=0,c=10){super(t,i);r(this,"dx");r(this,"dy");r(this,"ddx");r(this,"ddy");r(this,"radius");this.x=t,this.y=i,this.dx=e,this.dy=o,this.ddx=h,this.ddy=d,this.radius=c}force(t,i){return this.ddx+=t,this.ddy+=i,this}willCollideWith(t,i){const e=this.x+this.dx*t,o=this.y+this.dy*t,h=i.x+i.dx*t,d=i.y+i.dy*t;return Math.sqrt((e-h)**2+(o-d)**2)<=this.radius+i.radius}collideWith(t,i){if(this.willCollideWith(t,i)){const e=Math.sqrt((this.x-i.x)**2+(this.y-i.y)**2),[o,h]=[this.x-i.x,this.y-i.y],[d,c]=[o/e,h/e],[a,l]=[this.dx,this.dy],[u,y]=[i.dx,i.dy],m=(a*d+l*c)*.8,g=(u*d+y*c)*.8,[E,A]=[m*d,m*c],[k,W]=[g*d,g*c],[b,v]=[a-E*2,l-A*2],[S,z]=[u-k*2,y-W*2];this.dx=b,this.dy=v,i.dx=S,i.dy=z}return this}update(t){this.x+=this.dx*t,this.y+=this.dy*t,this.dx+=this.ddx*t,this.dy+=this.ddy*t}render(t){throw new Error("Not implemented")}}class C extends f{constructor(t,i,e){super(t,i,0,0,0,0,e);r(this,"radius");r(this,"audio");r(this,"duration");this.x=t,this.y=i,this.radius=e,this.audio=new Audio("/A.wav"),this.duration=0}collideWith(t,i){return this.willCollideWith(t,i)&&this.audio.readyState===4&&(this.audio.load(),this.audio.play(),this.duration=1),super.collideWith(t,i)}update(t){super.update(t),this.duration-=t,this.duration<0&&(this.duration=0)}render(t){t.beginPath(),t.fillStyle="#cccccc",t.arc(this.x,this.y,this.radius+this.duration*this.duration*8,0,2*Math.PI),t.fill(),t.closePath(),t.beginPath(),t.fillStyle="black",t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill(),t.closePath()}}const p=.125;class x extends f{constructor(t,i,e,o){super(t,i);r(this,"gap");r(this,"rows");r(this,"radius");r(this,"pinList");this.rows=e,this.pinList=[];const h=N(e);this.gap=o/(e+1),this.radius=this.gap*p;let d=3,c=d,[a,l]=[t-this.gap,i];for(let u=0;u<h;u++)this.pinList.push(new C(a,l,this.radius)),a+=this.gap,c-=1,c===0&&(d++,c=d,a=a-this.gap*d+this.gap/2,l=l+this.gap*Math.sqrt(3)/2)}collideWith(t,i){return this.pinList.forEach(e=>e.collideWith(t,i)),this}update(t){this.pinList.forEach(i=>i.update(t))}render(t){this.pinList.forEach(i=>i.render(t))}}const N=n=>{if(n<0)throw new Error("Rows must be positive");return(n+5)*n/2};class w extends f{constructor(s,t,i=10){super(s,t,0,0,0,0,i)}render(s){s.beginPath(),s.arc(this.x,this.y,this.radius,0,2*Math.PI),s.fillStyle="gray",s.fill(),s.closePath()}}class B extends f{constructor(t,i,e){super(t,i);r(this,"count");r(this,"size");this.count=0,this.size=e}collideWith(t,i){return this.willCollideWith(t,i)&&(this.count+=1,i.destroy()),this}render(t){t.beginPath(),t.rect(this.x-this.size*.5,this.y-this.size*.5,this.size,this.size),t.fillStyle="gray",t.fill(),t.fillStyle="black",t.font="20px Arial",t.fillText(this.count.toString(),this.x,this.y+this.size,this.size),t.closePath()}}class P extends f{constructor(t,i,e,o){super(t,i);r(this,"count");r(this,"coinPocketList");this.count=0,this.coinPocketList=[];const h=e*(1-p*2),d=e*p;let[c,a]=[t-e*o/2+d+h/2,i];for(let l=0;l<o;l++)this.coinPocketList.push(new B(c,a,h)),c+=e}collideWith(t,i){return this.coinPocketList.forEach(e=>e.collideWith(t,i)),this}render(t){this.coinPocketList.forEach(i=>i.render(t))}}class q{constructor(s){r(this,"atomList");r(this,"ctx");this.atomList=[],this.ctx=s}run(){let t=performance.now();const i=async()=>{const e=performance.now(),o=Math.min(e-t,200);t+=o;for(let h=0;h<o/5;h++)this.update(5/1e3);this.render(this.ctx),requestAnimationFrame(i)};requestAnimationFrame(i)}add(s){this.atomList.push(s)}sub(s){this.atomList=this.atomList.filter(t=>t!==s)}update(s){this.atomList=this.atomList.filter(o=>o.alive);const t=this.atomList.find(o=>o instanceof x),i=this.atomList.find(o=>o instanceof P),e=this.atomList.filter(o=>o instanceof w);e.forEach(o=>t.collideWith(s,o)),e.forEach(o=>i.collideWith(s,o)),this.atomList.forEach(o=>o.update(s)),this.atomList=this.atomList.filter(o=>!o.isOutOfScreen(this.ctx.canvas.width,this.ctx.canvas.height))}render(s){s.clearRect(0,0,s.canvas.width,s.canvas.height),this.atomList.forEach(t=>t.render(s))}}const L=n=>{const{width:s,height:t}=window.getComputedStyle(n);n.width=parseInt(s)*2,n.height=parseInt(t)*2};(()=>{const n=document.getElementById("app");L(n),window.addEventListener("resize",()=>L(n));const s=n.width,t=n.height,i=n.getContext("2d"),e=new q(i);e.run();const o=new x(s*.5,t*.3,20,s*.8),h=new P(s*.5,t*.765,o.gap,o.rows+1);e.add(o),e.add(h),window.addEventListener("keydown",d=>{if(d.keyCode===32){const[c,a]=[s*.5+(Math.random()-.5)*s*.05,t*.27];e.add(new w(c,a,o.radius*2).force(0,1e3))}})})();

</script>
    <style>
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif}#app{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:50rem;height:70rem}

</style>
  </head>
  <body>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QY8Q10SGTD"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QY8Q10SGTD');
    </script>
    <canvas id="app"></canvas>
    
  </body>
</html>
